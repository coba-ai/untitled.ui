<nav aria-label="Progress" class="<%= root_classes %>">
  <% steps.each_with_index do |step, index| %>
    <% state = step_state(index) %>

    <div class="flex flex-1 flex-col items-center text-center">
      <%# Icon row with connectors %>
      <div class="flex w-full items-center">
        <%# Left connector (hidden for first step) %>
        <% if index > 0 %>
          <div class="<%= connector_classes(step_state(index - 1) == :completed ? :completed : :upcoming) %>"></div>
        <% else %>
          <div class="h-0.5 w-full"></div>
        <% end %>

        <%# Icon %>
        <div class="<%= icon_outer_classes(state) %>">
          <% if state == :completed %>
            <span class="<%= icon_inner_classes(state) %>"><%= checkmark_svg.html_safe %></span>
          <% elsif step[:icon].present? %>
            <span class="<%= icon_inner_classes(state) %>"><%= step[:icon].html_safe %></span>
          <% else %>
            <span class="<%= dot_classes(state) %>"></span>
          <% end %>
        </div>

        <%# Right connector (hidden for last step) %>
        <% if index < steps.size - 1 %>
          <div class="<%= connector_classes(state == :completed ? :completed : :upcoming) %>"></div>
        <% else %>
          <div class="h-0.5 w-full"></div>
        <% end %>
      </div>

      <%# Labels %>
      <div class="mt-3 px-1">
        <p class="<%= title_classes(state) %>"><%= step[:title] %></p>
        <% if step[:description].present? %>
          <p class="<%= description_classes(state) %>"><%= step[:description] %></p>
        <% end %>
      </div>
    </div>
  <% end %>
</nav>
